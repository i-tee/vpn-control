version: "3.8"

services:
    # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (PHP + Laravel)
    app:
        build: .
        container_name: gatekeeper-app
        restart: unless-stopped
        working_dir: /var/www/html
        volumes:
            - ./:/var/www/html
            - ./storage:/var/www/html/storage
            - ./bootstrap/cache:/var/www/html/bootstrap/cache
        depends_on:
            - redis

    # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–º Nginx
    web:
        image: nginx:alpine
        container_name: gatekeeper-nginx
        restart: unless-stopped
        ports:
            - "8080:80"
        volumes:
            - ./:/var/www/html
            - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
        depends_on:
            - app

    # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å Redis
    redis:
        image: redis:alpine
        container_name: gatekeeper-redis
        restart: unless-stopped
        ports:
            - "6379:6379"

    # üìß –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—á—Ç—ã (Mailpit)
    mailpit:
        image: axllent/mailpit:latest
        container_name: gatekeeper-mailpit
        restart: unless-stopped
        ports:
            - "8025:8025" # –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Mailpit (http://localhost:8025)
            - "1025:1025" # SMTP –ø–æ—Ä—Ç (—É–∂–µ —É–∫–∞–∑–∞–Ω –≤ .env)
        environment:
            MP_SMTP_AUTH_ACCEPT_ANY: "true" # –ü—Ä–∏–Ω–∏–º–∞—Ç—å –ª—é–±–æ–π –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å
            MP_SMTP_AUTH_ALLOW_INSECURE: "true" # –ë–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (–¥–ª—è –ª–æ–∫–∞–ª–∫–∏)
            MP_UI_MESSAGE_VIEWER: "true" # –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å HTML-–≤–µ—Ä—Å–∏—é –ø–∏—Å–µ–º
